"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[289],{9289:(e,t,r)=>{r.r(t),r.d(t,{default:()=>X});var a=r(6326),i=r(5043),s=r(4768);var n=r(3532),o=r(1306),c=0;function l(){var e=c;return c++,e}var u=function(e){var t=e.children,r=e.initial,a=e.isPresent,s=e.onExitComplete,c=e.custom,u=e.presenceAffectsLayout,m=(0,o.M)(d),h=(0,o.M)(l),f=(0,i.useMemo)((function(){return{id:h,initial:r,isPresent:a,custom:c,onExitComplete:function(e){m.set(e,!0);var t=!0;m.forEach((function(e){e||(t=!1)})),t&&(null===s||void 0===s||s())},register:function(e){return m.set(e,!1),function(){return m.delete(e)}}}}),u?void 0:[a]);return(0,i.useMemo)((function(){m.forEach((function(e,t){return m.set(t,!1)}))}),[a]),i.useEffect((function(){!a&&!m.size&&(null===s||void 0===s||s())}),[a]),i.createElement(n.t.Provider,{value:f},t)};function d(){return new Map}var m=r(4827);function h(e){return e.key||""}var f=function(e){var t=e.children,r=e.custom,n=e.initial,o=void 0===n||n,c=e.onExitComplete,l=e.exitBeforeEnter,d=e.presenceAffectsLayout,f=void 0===d||d,v=function(){var e=(0,i.useRef)(!1),t=(0,a.zs)((0,i.useState)(0),2),r=t[0],n=t[1];return(0,s.l)((function(){return e.current=!0})),(0,i.useCallback)((function(){!e.current&&n(r+1)}),[r])}(),p=(0,i.useContext)(m.R2);(0,m.mt)(p)&&(v=p.forceUpdate);var _=(0,i.useRef)(!0),y=function(e){var t=[];return i.Children.forEach(e,(function(e){(0,i.isValidElement)(e)&&t.push(e)})),t}(t),C=(0,i.useRef)(y),g=(0,i.useRef)(new Map).current,x=(0,i.useRef)(new Set).current;if(function(e,t){e.forEach((function(e){var r=h(e);t.set(r,e)}))}(y,g),_.current)return _.current=!1,i.createElement(i.Fragment,null,y.map((function(e){return i.createElement(u,{key:h(e),isPresent:!0,initial:!!o&&void 0,presenceAffectsLayout:f},e)})));for(var j=(0,a.fX)([],(0,a.zs)(y)),S=C.current.map(h),k=y.map(h),w=S.length,N=0;N<w;N++){var I=S[N];-1===k.indexOf(I)?x.add(I):x.delete(I)}return l&&x.size&&(j=[]),x.forEach((function(e){if(-1===k.indexOf(e)){var t=g.get(e);if(t){var a=S.indexOf(e);j.splice(a,0,i.createElement(u,{key:h(t),isPresent:!1,onExitComplete:function(){g.delete(e),x.delete(e);var t=C.current.findIndex((function(t){return t.key===e}));C.current.splice(t,1),x.size||(C.current=y,v(),c&&c())},custom:r,presenceAffectsLayout:f},t))}}})),j=j.map((function(e){var t=e.key;return x.has(t)?e:i.createElement(u,{key:h(e),isPresent:!0,presenceAffectsLayout:f},e)})),C.current=j,i.createElement(i.Fragment,null,x.size?j:j.map((function(e){return(0,i.cloneElement)(e)})))},v=r(1605),p=r(9698),_=r(6720),y=r(7196),C=r(397),g=r(3003),x=r(2115),j=r(7752),S=r(7950);const k="ConfirmationModalCart_modal__4yYLL",w="ConfirmationModalCart_buttonGroup__HwMAD",N="ConfirmationModalCart_yesButton__MmvAm",I="ConfirmationModalCart_noButton__RlDJG";var E=r(579);const R=(0,i.forwardRef)(((e,t)=>{let{item:r,userId:a,token:s,onCartUpdate:n,actionType:o}=e;const c=(0,i.useRef)(),l=(0,g.wA)();var u="";(0,i.useImperativeHandle)(t,(()=>({open(){c.current&&c.current.showModal()},close(){c.current&&c.current.close()}})));const d=()=>{c.current&&c.current.close()};return"checkout"===o?u="Do you wish to Checkout?":"wishlist"===o?u="If you add to Wishlist, it will be removed from Cart. Do you wish to proceed?":"delete"===o&&(u="Do you wish to delete this item from Cart?"),(0,S.createPortal)((0,E.jsxs)("dialog",{ref:c,className:k,children:[(0,E.jsx)("h2",{children:"Confirmation"}),(0,E.jsx)("p",{children:u}),(0,E.jsxs)("div",{className:w,children:[(0,E.jsx)("button",{className:N,onClick:async()=>{try{if("checkout"===o){const e=await fetch(`http://localhost:5000/api/cart/checkout/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),t=await e.json();if(!t.ok&&!t.cart)return void x.oR.error(t.message);x.oR.success(t.message);let r=0;r=t.cart.movie_tv.reduce(((e,t)=>e+t.quantity),0),localStorage.setItem("cartSize",r),l(j.tV.setInitialValue({type:"cart",value:r})),localStorage.setItem("cart",JSON.stringify(t.cart.movie_tv)),l(j.fo.setInitialValue({type:"cart",value:t.cart.movie_tv}))}else if("wishlist"===o){const e=await fetch(`http://localhost:5000/api/wishlist/add/${a}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({id:r.id,type:r.type,title:r.title,price:r.price})}),t=await e.json();if(!t.ok&&!t.wishlist)return void x.oR.error(t.message);x.oR.success(t.message);const i=await fetch(`http://localhost:5000/api/cart/delete/${a}/${r.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),n=await i.json();if(!n.ok&&!n.removedItem)return void x.oR.error(n.message);x.oR.success(n.message);let o=0;o=n.cart.movie_tv.reduce(((e,t)=>e+t.quantity),0),localStorage.setItem("cartSize",o),l(j.tV.setInitialValue({type:"cart",value:o})),localStorage.setItem("cart",JSON.stringify(n.cart.movie_tv)),l(j.fo.setInitialValue({type:"cart",value:n.cart.movie_tv})),localStorage.setItem("wishlistSize",t.wishlist.movie_tv.length),l(j.tV.setInitialValue({type:"wishlist",value:t.wishlist.movie_tv.length})),localStorage.setItem("wishlist",JSON.stringify(t.wishlist.movie_tv)),l(j.fo.setInitialValue({type:"wishlist",value:t.wishlist.movie_tv}))}else if("delete"===o){const e=await fetch(`http://localhost:5000/api/cart/delete/${a}/${r.id}`,{method:"DELETE",headers:{Authorization:"Bearer "+s}}),t=await e.json();if(!t.ok&&!t.removedItem)return void x.oR.error(t.message);x.oR.success(t.message);let i=0;i=t.cart.movie_tv.reduce(((e,t)=>e+t.quantity),0),localStorage.setItem("cartSize",i),l(j.tV.setInitialValue({type:"cart",value:i})),localStorage.setItem("cart",JSON.stringify(t.cart.movie_tv)),l(j.fo.setInitialValue({type:"cart",value:t.cart.movie_tv}))}n(),d()}catch(e){console.error(e.message),x.oR.error("An error occurred. Please try again.")}},children:"Yes"}),(0,E.jsx)("button",{className:I,onClick:d,children:"No"})]})]}),document.getElementById("modal"))})),b="Cart_cartContainerinside__rjscu",A="Cart_cartItem__wzl20",z="Cart_itemDetails__HRS5t",O="Cart_itemType__rcRXs",V="Cart_itemTitle__NX3E5",P="Cart_itemControls__6-rRD",B="Cart_counterButton__Rcxab",M="Cart_quantity__SuZku",T="Cart_itemPrice__GckXA",$="Cart_icon__Y9WBf",J="Cart_deleteIcon__iRB4d",D="Cart_totalContainer__0uNOo",L="Cart_emptyMessage__OR2k8",q="Cart_checkoutContainer__Q9t2C",F="Cart_checkoutButton__TtQcj",H="Cart_cartContainer__Q1STx",Q="Cart_header__1b9-o",U="Cart_refreshButton__7wZmQ",X=()=>{const e=Number(JSON.parse(localStorage.getItem("userinfo")).id),t=localStorage.getItem("token"),r=(0,i.useRef)(),a=(0,g.wA)(),[s,n]=(0,i.useState)(null),[o,c]=(0,i.useState)(""),[l,u]=(0,i.useState)(JSON.parse(localStorage.getItem("cart"))||[]),d=async(r,i)=>{try{const s=await fetch(`http://localhost:5000/api/cart/update/${e}/${r}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({identifier:i})}),n=await s.json();if(!n.ok&&!n.cart)return void x.oR.error(n.message);let o=0;o=n.cart.movie_tv.reduce(((e,t)=>e+t.quantity),0),localStorage.setItem("cart",JSON.stringify(n.cart.movie_tv)),a(j.fo.setInitialValue({type:"cart",value:n.cart.movie_tv})),localStorage.setItem("cartSize",o),a(j.tV.setInitialValue({type:"cart",value:o})),u(n.cart.movie_tv)}catch(s){console.error(s.message)}},m=(e,t)=>{n(e),c(t),r.current&&r.current.open()},h={hidden:{scale:0,opacity:0},visible:{scale:1,opacity:1}},S=l.reduce(((e,t)=>e+t.price*t.quantity),0);return(0,E.jsxs)("div",{className:H,children:[(0,E.jsx)("div",{className:Q,children:(0,E.jsxs)("button",{className:U,onClick:()=>{const e=JSON.parse(localStorage.getItem("cart"))||[];u(e)},children:[(0,E.jsx)(p.JbZ,{})," Refresh"]})}),0===l.length?(0,E.jsx)("div",{className:L,children:"Cart is empty! Please add something!"}):(0,E.jsxs)("div",{className:b,children:[(0,E.jsx)(f,{children:l.map((e=>(0,E.jsxs)(v.P.div,{className:A,variants:h,initial:"hidden",animate:"visible",exit:{scale:0,opacity:0},transition:{duration:.5},children:[(0,E.jsxs)("div",{className:z,children:[(0,E.jsx)("p",{className:O,children:e.type.toUpperCase()}),(0,E.jsx)("p",{className:V,children:e.title})]}),(0,E.jsxs)("div",{className:P,children:[(0,E.jsx)("button",{className:B,onClick:()=>d(e.id,"decrease"),children:"-"}),(0,E.jsx)("span",{className:M,children:e.quantity}),(0,E.jsx)("button",{className:B,onClick:()=>d(e.id,"increase"),children:"+"})]}),(0,E.jsxs)("p",{className:T,children:[(0,E.jsx)(C.h4P,{}),(e.price*e.quantity).toFixed(2)]}),(0,E.jsx)(y.ANW,{className:$,onClick:()=>m(e,"wishlist")}),(0,E.jsx)(_.kgr,{className:`${$} ${J}`,onClick:()=>m(e,"delete")})]},e.id)))}),(0,E.jsx)("div",{className:D,children:(0,E.jsxs)("h3",{children:["Total: ",(0,E.jsx)(C.h4P,{}),S.toFixed(2)]})}),(0,E.jsx)("div",{className:q,children:(0,E.jsx)("button",{className:F,onClick:()=>{c("checkout"),r.current&&r.current.open()},children:"Checkout"})})]}),(0,E.jsx)(R,{ref:r,item:s,userId:e,token:t,onCartUpdate:()=>u(JSON.parse(localStorage.getItem("cart"))||[]),actionType:o})]})}}}]);
//# sourceMappingURL=289.18fdc2bf.chunk.js.map